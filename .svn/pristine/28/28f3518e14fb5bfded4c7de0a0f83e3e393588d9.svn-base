<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>  
<html>
<head>
	<meta charset="UTF-8">
    <title>system-Account</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/static/styles/css/ace-fonts.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/font-awesome.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/bootstrap-table.min.css"/>
    <link rel="stylesheet" href="/static/scripts/gecko-modules/bootstrap/bootstrap-editable.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/css/ace.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/gecko.css"/>
    <script type="text/javascript" src="/static/scripts/gecko-modules/jquery/jquery.js"></script>
    <script src="//apps.bdimg.com/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
    <script type="text/javascript" src="/static/scripts/gecko-modules/bootstrap/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/scripts/gecko-modules/bootstrap/bootstrap-table.js"></script>
    <script src="/static/scripts/gecko-modules/bootstrap/bootstrap-table-editable.js"></script>
    <script src="/static/scripts/gecko-modules/bootstrap/bootstrap-editable.min.js"></script>
    <script type="text/javascript" src="/static/scripts/gecko-modules/bootstrap/bootstrap-table-zh-CN.js"></script>
    <script type="text/javascript" src="/static/scripts/app/system/comm/utils.js"></script>
    <script type="text/javascript" src="/static/scripts/system/account/account.js"></script>

<title>投诉举报流程</title>
</head>
<body>
<!--顶部按钮-->

    <div class="btn-group">
        <button id="add" class="btn btn-md btn-success" onclick="entrust();">委托</button>
    </div>

<div id="showAccount">
	 <table id="accountTable"></table>
</div>

 	<div class="page-content">
    <table id="taskList"></table>
	</div>
</body>
</html>
<script type="text/javascript">
$(function () {
	$("#taskList").bootstrapTable({
                //toolbar: "#toolbar",
                idField: "id",
                //pagination: true,
                limit: 15,
                showRefresh: true,
                sidePagination: "server",
                search: true,
                url: "/workflow/taskList",
                columns: [{
                    checkbox: true
                }, {
                    field: "id",
                    visible: false
                }, {
                    field: "id",
                    title: "任务ID",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "name",
                    title: "任务名称",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "createTime",
                    title: "创建时间",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "assignee",
                    title: "办理人",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }, {
                    field: 'operate',
                	title: '操作',
                	align: 'center',
                	width : 100,
                	//events: operateEvents,
                	formatter: operateFormatter
                }]
            });
});
	function operateFormatter(value, row, index) {
      return [
      '<button id="oleOfedit" onclick="javascript:b('+row.id+');" type="button" class="oleOfedit btn btn-primary  btn-sm" style="margin-right:15px;">举报流程</button>'
      ,'<button id="oleOfedit" onclick="javascript:a('+row.id+');" type="button" class="oleOfedit btn btn-primary  btn-sm" style="margin-right:15px;">查看当前流程图</button>'
      ].join('');
	};
	window.operateEvents = {
	    'click .oleOfedit': function (e, value, row, index) {
	    	33();
	    	alert(111);
	    	
	    	console.log(row);
	    	//window.location.href="/workflow/startProcess?id="+row.id; 
		}
	};
	function a(taskId){
		window.open("/workflow/viewCurrentImage?taskId="+taskId);
	}
	function b(taskId){
		window.location.href = "/workflow/autio?taskId="+taskId;
	}
	//委托办理，弹出人员选择
	var tasks = [];
	function entrust(){
            var selected = $("#taskList").bootstrapTable("getSelections");
            selected.forEach(function (t) {
                tasks.push(t.id)
            });
		$( "#showAccount" ).dialog({
      height: 140,
      width:438,
      modal: true
    });
	//$("#operation").val();
	var tableId = "accountTable";
	$("#" + tableId).bootstrapTable({
	 			//method: 'get',
	 			//queryParams:queryParams,
				editable:false,//关闭编辑模式  
                toolbar: "#toolbar",
                idField: "id",
                pagination: true,
                limit: 15,
                showRefresh: true,
                sidePagination: "server",
                search: true,
                url: "/system/account/list",
                columns: [{
                    checkbox: true
                }, {
                    field: "id",
                    visible: false
                }, {
                    field: "realName",
                    title: "真实姓名",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "principal",
                    title: "账号",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                },{
                field: 'operate',
                title: '操作',
                align: 'center',
                width : 100,
                events: operateEvents2,
               formatter: operateFormatter2
                }],
                onEditableSave: function (field, row, oldValue, e) {
                    var data = {name: field, pk: row.id, value: row[field]};
                    $.ajax({
                        type: "post",
                        url: "/system/account/edit",
                        data: data,
                        dataType: 'JSON',
                        content: "application/json;charset=UTF8",
                        success: function (data, status) {
                            if (status === "success") {
                                //info("authorityTable", '修改成功');
                            }
                        },
                        error: function () {
                            //info('authorityTable', '编辑失败');
                        },
                        complete: function () {

                        }
                    });
                }
                
            });
	}
	function operateFormatter2(value, row, index) {
      return [
      '<button id="oleOf"  type="button" class="oleOf btn btn-primary  btn-sm" style="margin-right:15px;">选择</button>'
       ].join('');
	};
	window.operateEvents2 = {
	    'click .oleOf': function (e, value, row, index) {
	    var tasksStr = tasks.join(",");
	    	 $.ajax({
                    url: "/workflow/entrust", 
                    data:{"client":row.realName,"tasks":tasksStr},
                    //type: "",
                    contentType: "application/json;charset=utf8",
                    success: function (resp) {
                        if (resp.code === 0) {
                            //info(tableId, "删除成功");
                            table.bootstrapTable('remove', {field: 'id', values: ids});
                        }
                    }
              });
        $('#showAccount').dialog('close');	
	    }
	};
	function c(client1){
			alert(client1);
             $.ajax({
                    url: "/workflow/entrust", 
                    data:{"client":client,"tasks":JSON.stringify(tasks)},
                    //type: "",
                    contentType: "application/json;charset=utf8",
                    success: function (resp) {
                        if (resp.code === 0) {
                            //info(tableId, "删除成功");
                            table.bootstrapTable('remove', {field: 'id', values: ids});
                        }
                    }
              });
        $('#showAccount').dialog('close');
	}

</script>