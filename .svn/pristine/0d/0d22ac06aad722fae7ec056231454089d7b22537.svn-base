<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>  
<html>
<head>
	<meta charset="UTF-8">
    <title>system-Account</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/static/styles/css/ace-fonts.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/font-awesome.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/bootstrap-table.min.css"/>
    <link rel="stylesheet" href="/static/scripts/gecko-modules/bootstrap/bootstrap-editable.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/css/ace.css"/>
   
    <link rel="stylesheet" href="/static/styles/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/styles/css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" href="/static/styles/css/jquery-ui.custom.min.css" />
	<link rel="stylesheet" href="/static/styles/css/chosen.min.css" />
	
	<!-- ace styles -->
		<link rel="stylesheet" href="/static/static/css/system/ace/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
		<![endif]-->
		<link rel="stylesheet" href="/static/static/css/system/ace/ace-skins.min.css" />
		<link rel="stylesheet" href="/static/static/css/system/ace/ace-rtl.min.css" />

		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->
	<script type="text/javascript" src="/static/scripts/gecko-modules/jquery/jquery-2.2.1.min.js"></script>
    <script src="/static/scripts/gecko-modules/bootstrap/bootstrap.min.js"></script>
    
    <script type="text/javascript" src="/static/scripts/gecko-modules/bootstrap/bootstrap-table.js"></script>
	<!-- ace scripts -->
	<script src="/static/scripts/gecko-modules/ace/ace-elements.min.js"></script>
	<script src="/static/scripts/gecko-modules/ace/ace.min.js"></script>
		<script type="text/javascript" src="/static/scripts/gecko-modules/bootstrap/bootstrap-table-zh-CN.js"></script>
	
	<script src="/static/scripts/gecko-modules/bootstrap/bootstrap-datetimepicker.js"></script>
   
<style>
.moreCondition{
	display:none;
}
</style>		
<title>投诉举报流程</title>
</head>
<body class="no-skin">
<!--顶部按钮-->
<div class="page-content">
<form id="queryForm" role="form" action="/workflow/complaint/taskList">
<table class="table table-hover">
 <tbody class="form-inline">  
	<tr class="table-bordered">
		<td class="col-md-4 table-bordered"  width="33%">
			<label class="bolder blue control-label"  for="form-field-1">开始日期：</label>
			<input name="search"  id="startDate" type="text" class="form-control"/>
		</td>
		<td class="col-md-4 table-bordered"  width="33%">
			<label class="control-label bolder blue" for="form-field-1">&nbsp;&nbsp;&nbsp;&nbsp;结束日期：</label>
			<input name="search" id="endDate" type="text" class="form-control"/>
		</td>
		<td class="col-md-4 table-bordered"  width="34%">
        <label class="control-label bolder blue">&nbsp;&nbsp;&nbsp;&nbsp;业务来源：</label>
        <select name="search" id="source">
			<option value="">&nbsp;请选择</option>
			<option value="1">&nbsp;自接收</option>
			<option value="2">&nbsp;上级交办</option>
			<option value="3">&nbsp;同级转办</option>
			<option value="4">&nbsp;其他</option>
		</select>
		</td>
	</tr>
	<tr class="table-bordered">
		<td class="col-md-4 table-bordered" >
		  <label class="bolder blue">业务类型：</label>
          <select name="search" id="businessType">
				<option value="">&nbsp;请选择</option>
				<option value="1">&nbsp;咨询</option>
				<option value="2">&nbsp;投诉举报</option>
				<option value="3">&nbsp;意见建议</option>
				<option value="4">&nbsp;表扬</option>
				<option value="5">&nbsp;其他</option>
	       </select>
	      </td>
	      <td class="col-md-4 table-bordered" >
	      	<label class="control-label bolder blue" for="form-field-1-1">&nbsp;&nbsp;&nbsp;&nbsp;接收方式：</span></label>
				<select name="search" id="acceptype">
					<option selected="" value="">请选择</option>
					<option value="1">&nbsp;电话</option>
					<option value="2">&nbsp;走访</option>
					<option value="3">&nbsp;信件</option>
					<option value="4">&nbsp;网络（网站、微信等）</option>
					<option value="5">&nbsp;电子邮件</option>
					<option value="6">&nbsp;短信</option>
					<option value="7">&nbsp;传真</option>
					<option value="8">&nbsp;语音留言</option>
					<option value="9">&nbsp;其他</option>
				</select>
	      </td>
	      <td class="col-md-4 table-bordered" >
	      	<label class="control-label bolder blue" for="form-field-1-1">&nbsp;&nbsp;&nbsp;&nbsp;受理员：</span></label>
	      	<input type="text" id="operator" name="search" style="width: 168px"/>
	      </td>
	 </tr>
	  <tr id='lessQuery' class="table-bordered">
	  	<td  colspan="3"  align="center">
	  	<button type="button" class="btn btn-primary" onclick="getMoreQuery()">显示更多条件</button>
	 	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	 	<button type="button" class="btn btn-primary" onclick="query()">查询</button>
	 	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	 	<button type="button" class="btn btn-primary" onclick="clear1()">重置</button>
	 	</td>
	 </tr> 
	 <tr class="table-bordered moreCondition" name="moreCondition">
	     <td class="col-md-4 table-bordered" >
	      	<label class="control-label bolder blue" for="form-field-1-1">信息编号：</span></label>
	      	<input type="text" id="infoid" name="search" style="width: 168px"/>
	      </td> 
	      <td class="col-md-4 table-bordered" >
	      	<label class="control-label bolder blue" for="form-field-1-1">&nbsp;&nbsp;&nbsp;&nbsp;是否超期：</span></label>
	      	<select name="isexceed" id="isexceed">
					<option selected="" value="">请选择</option>
					<option value="1">&nbsp;已超期</option>
					<option value="2">&nbsp;未超期</option>
			</select>
	      </td> 
	       <td class="col-md-4 table-bordered" >
	      	<label class="control-label bolder blue" for="form-field-1-1">&nbsp;&nbsp;&nbsp;&nbsp;反应内容：</span></label>
	      	<input type="text" id="content" name="search" style="width: 168px"/>
	      </td> 
	 </tr>
	 <tr class="table-bordered moreCondition" name="moreCondition">
	     <td class="col-md-6 table-bordered" colspan="3">
			 <div style="float: left;width:50%">
				 <label class="control-label bolder blue" for="form-field-1-1">排序字段：</span></label>
				 <input type="radio" id="orderType"  name="orderType" value="1"/>办结期限&nbsp;&nbsp;&nbsp;&nbsp;
				 <input type="radio" id="orderType" name="orderType" value="2"/>超期天数&nbsp;&nbsp;&nbsp;&nbsp;
				 <input type="radio" id="orderType" name="orderType" value="3"/>登记日期&nbsp;&nbsp;&nbsp;&nbsp;
			 </div>
			 <div  style="float: right;width:50%">
				 <label class="control-label bolder blue" for="form-field-1-1">&nbsp;&nbsp;&nbsp;&nbsp;排序类型：</span></label>
				 <input id="orderMethod" name="orderMethod" type="radio" class="ace" value="0"/>
				 <span class="lbl"> 升序</span>
				 <input id="orderMethod" name="orderMethod" type="radio" class="ace" value="1"/>
				 <span class="lbl"> 降序</span>

			 </div>

	      </td> 

	 </tr> 
	  <tr id='moreQuery' class="table-bordered moreCondition">
	  	<td  colspan="3"  align="center">
	 	<button type="button" class="btn btn-primary moreCondition" name="moreCondition" onclick="getlessQuery()">收起更多条件</button>
	 	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	 	<button type="button" class="btn btn-primary" onclick="query()">查询</button>
	 	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
	 	<button type="button" class="btn btn-primary" onclick="clear1()">重置</button>
	 	</td>
	 </tr> 

	</tbody>
	</table>
</form>
<table id="taskList"></table>
</div>
</body>
</html>
<script type="text/javascript">
$(function () {

		if(!ace.vars['old_ie']) $("input[id$='Date']").datetimepicker({
				 //format: 'YYYY/MM/DD h:mm:ss A',//use this option to display seconds
				 	format: 'yyyy-MM-dd hh:mm:ss',  
		        	language: 'cn',  
		        	pickDate: true,  
		        	pickTime: true,  
		       		hourStep: 1,  
		       		todayBtn : true,
		        	minuteStep: 1,  
		        	secondStep: 30,  
		        	inputMask: true  
				}).next().on(ace.click_event, function(){
					$(this).prev().focus();
				});
	
	$("#taskList").bootstrapTable({
                //toolbar: "#toolbar",
                idField: "id",
                
                //pagination: true,
                //limit: 15,
                pagination: true, //是否显示分页（*）     
                //showRefresh: true,
                sidePagination: "client",
                //search: true,
                pageNumber:1,                       //初始化加载第一页，默认第一页
               	//pageSize: 10,                       //每页的记录行数（*）
                pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                url: "/workflow/complaint/taskList",
                queryParams:queryParams,
                columns: [  
                [{
                         "title": "<div style='float:left'><img src='/static/scripts/gecko-modules/img/u152.png' class='img-rounded' >待办列表</div>"
                         +"<div style='float:right'><button id='withdraw' onclick='batchSign();' class='btn btn-xs btn-primary'>批量签收</button></div>",
                         "halign":"left",
                         "align":"center",
                         "colspan": 15
                }],
                [{
                    checkbox: true
                }, {
                    field: "id",
                    visible: false
                },{
                    field: 'state',
                    title: '限办预警',
                    align: 'center',
                    formatter: function(value,row,index){
                       return '<img src="'+value+'" class="img-rounded" >';
                    }
                  },{
                    field: "cpComplaintsreportId",
                    title: "信息编号",
                    type: "text",
                    search: "true",
                     sortable: true,
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "source",
                    title: "业务来源",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "assignee",
                    title: "受理员",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                },{
                    field: "businessType",
                    title: "业务类型",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                },{
                    field: "acceptype",
                    title: "接收方式",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                },{
                    field: "content",
                    title: "反应内容",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "registerdate",
                    title: "登记时间",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                },{
                    field: "limitdate",
                    title: "办结期限",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                },{
                    field: "status",
                    title: "签收",
                    align: 'center',
                    formatter: function(value,row,index){    
                      return value;
                      }
                }, {
                    field: 'operate',
                	title: '操作',
                	align: 'center',
                	width : 100,
                	//events: operateEvents,
                	formatter: operateFormatter
                }]]
            });
     	
});
	function operateFormatter(value, row, index) {
		//未签收(0)、未登记(1)、未办理（2）、办理中(3)、督办中(4)、已办结(5)、拒签(-1)
		if("-"==row.status|| "未签收"==row.status||null==row.status){
             return  [
                 "<a onclick='javascript:refuse("+row.cpComplaintsreportId+")'>拒签</a><a onclick='javascript:sign("+row.cpComplaintsreportId+")'>签收</a>"
                 ].join('');
        }else if(row.status=="未登记"){
			 return [
			      '<button id="oleOfedit" onclick="javascript:c('+row.cpComplaintsreportId+');" type="button" class="oleOfedit btn btn-primary  btn-sm" style="margin-right:15px;">登记</button>'
			      ].join('');
		}else if(row.status=="未办理"||row.status=="办理中"||row.status=="督办中"){
			return [
			      '<button id="oleOfedit" onclick="javascript:b('+row.id+','+row.cpComplaintsreportId+');" type="button" class="oleOfedit btn btn-primary  btn-sm" style="margin-right:15px;">办理</button>'
			      ].join('');
		}
     
	};
	window.operateEvents = {
	    'click .oleOfedit': function (e, value, row, index) {
	    	33();
	    	alert(111);
	    	
	    	console.log(row);
	    	//window.location.href="/workflow/startProcess?id="+row.id; 
		}
	};
	function a(taskId){
		window.open("/workflow/viewCurrentImage?taskId="+taskId);
	}
	function b(taskId,cpComplaintsreportId){
		window.location.href = "/workflow/complaint/autio?taskId="+taskId+"&&cpComplaintsreportId="+cpComplaintsreportId;
	}
	function c(cpComplaintsreportId){
		window.location.href = "/complaint/cpcomplaintsreport/registerView?cpComplaintsreportId="+cpComplaintsreportId;
	}
	function queryParams(params) {
	    var param = {
	    	isexceed: $("#isexceed").val(),
	        source : $("#source").val(),
	        businessType : $("#businessType").val(),
	        startDate : $("#startDate").val(),
	        endDate : $("#endDate").val(),
	        acceptype : $("#acceptype").val(),
	        operator : $("#operator").val(),
	        infoid : $("#infoid").val(),
	        content : $("#content").val(),
	        orderMethod:$("input[name='orderMethod']:checked").val(),
	       	orderType:$("input[name='orderType']:checked").val()
	    }
	    return param;
	} 
	function query(){
	  $('#taskList').bootstrapTable('refresh');  
	}
	
	function clear1(){
		//alert(11);
		document.getElementById("queryForm").reset();
	}
	function getMoreQuery(){
		$("[name='moreCondition']").removeClass("moreCondition");
		$("#lessQuery").hide();
		$("#moreQuery").show();
	}
	function getlessQuery(){
		$("[name='moreCondition']").addClass("moreCondition");
		$("#moreQuery").hide();
		$("#lessQuery").show();
	}
</script>
<script>
function refuse(cpComplaintreportId){
	window.location.href = "/complaint/cpcomplaintsreport/refuse?cpComplaintreportId="+cpComplaintreportId;
}
function sign(cpComplaintreportId){
	window.location.href = "/complaint/cpcomplaintsreport/sign?cpComplaintreportId="+cpComplaintreportId;
}
function batchSign(){
	var a= $("#taskList").bootstrapTable('getSelections');

	if(a.length>0){
		var cpComplaintreportIds=[];
		var status = "";
		$.each(a, function(i, value) {
			if("0"==value.status){
				cpComplaintreportIds.push(value.cpComplaintsreportId);
			}else{
				status = "isSigned";
			}
		});
		if("isSigned"==status){
			alert("选择项中有案件已经被签收!");
		}else{
			$.ajax({
		　　url:'/complaint/cpcomplaintsreport/batchSign',
		   async:false,
		　　type:'PUT',
		　 	contentType: "application/json",
		   //traditional :true,//防止jquery会深度序列化参数对象
		　　data:JSON.stringify(cpComplaintreportIds)
		});
		}
		
		
	}else{alert("请选中一行!")}
}
</script>