<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.gecko.framework.complaint.repository.dao.CpComplaintsreportDao">
	 <select id="likeByPageWithActiviti" resultMap="CpComplaintsreport" parameterType="org.gecko.framework.complaint.entity.CpComplaintsreport">
        select CpComplaintsreport.* from CP_COMPLAINTSREPORT CpComplaintsreport where 1=1 and CpComplaintsreport.refid is null
     <if test="param.content!=null"> and CpComplaintsreport.title like #{param.content}</if>
     <if test="param.source!=null"> and CpComplaintsreport.SOURCE like #{param.source}</if>
     <if test="param.acceptype!=null"> and CpComplaintsreport.ACCEPTYPE like #{param.acceptype}</if>
     <if test="param.limitdate!=null"> and CpComplaintsreport.LIMITDATE like #{param.limitdate}</if>
     <if test="param.acceptedDate!=null and param.registerdate!=null"> and CpComplaintsreport.REGISTERDATE BETWEEN #{param.acceptedDate} AND #{param.registerdate}</if>
     <if test="param.acceptedDate!=null and param.registerdate==null"> and CpComplaintsreport.REGISTERDATE BETWEEN #{param.acceptedDate} AND to_DATE('9999-12-31','yyyy-MM-dd')</if>
     <if test="param.acceptedDate==null and param.registerdate!=null"> and CpComplaintsreport.REGISTERDATE BETWEEN to_DATE('0000-01-01','yyyy-MM-dd') AND #{param.registerdate}</if>
     <if test="param.infoid!=null"> and CpComplaintsreport.id like #{param.infoid}</if>
     <if test="param.businessType!=null"> and CpComplaintsreport.BUSINESS like #{param.businessType}</if>
     <if test="param.operator!=null"> and CpComplaintsreport.OPERATOR like #{param.operator}</if>
     
     <if test="param.temp6!=null"> and CpComplaintsreport.TEMP6 like #{param.temp6}</if>
     <!-- 反馈人 -->
     <if test="param.feedback!=null"> and CpComplaintsreport.feedback not like "-"</if>
     
     <if test='param.isdelay=="1"'> and CpComplaintsreport.limitDate  &lt; (select to_date((select to_char(SYSDATE,'yyyy-mm-dd') from dual),'yyyy-mm-dd') from dual) and CpComplaintsreport.status ！='5'</if> 
     <if test='param.isdelay=="2"'> and CpComplaintsreport.limitDate  &gt; (select to_date((select to_char(SYSDATE,'yyyy-mm-dd') from dual),'yyyy-mm-dd') from dual) or CpComplaintsreport.status ='5'</if>     
   
     <if test="param.temp1!=null or param.temp2!=null or param.temp3!=null"> ORDER BY</if>
     <if test='param.temp1=="1"'> CpComplaintsreport.LIMITDATE</if>
     <if test='param.temp1=="3"'> CpComplaintsreport.registerdate</if>
     <if test='param.temp1=="2"'> (select( trunc(sysdate) - CpComplaintsreport.limitDate )from dual) </if>
     
     <if test="param.temp5!=null"> ASC</if>
     <if test="param.temp4!=null"> DESC</if>
     </select>
     
     <select id="likeByPageWithDepartment" resultMap="CpComplaintsreport" parameterType="org.gecko.framework.complaint.entity.CpComplaintsreport">
        select CpComplaintsreport.* from CP_COMPLAINTSREPORT CpComplaintsreport 
		inner join system_org_account soa on CpComplaintsreport.Temp6 = soa.account_id where 1=1
	 <if test="param.area!=null"> and soa.orgnization_id in (select id from system_organizations where id like #{param.area})</if>
	 <if test="param.status!=null"> and CpComplaintsreport.status like #{param.status}</if>
	 <if test='param.feedback=="1"'> and CpComplaintsreport.feedback is not null and CpComplaintsreport.feedback !='-'</if>
	 <if test='param.feedback=="2"'> and CpComplaintsreport.feedback is null or CpComplaintsreport.feedback ='-'</if>
     <if test="param.content!=null"> and CpComplaintsreport.CONTENT like #{param.content}</if>
     <if test="param.source!=null"> and CpComplaintsreport.SOURCE like #{param.source}</if>
     <if test="param.acceptype!=null"> and CpComplaintsreport.ACCEPTYPE like #{param.acceptype}</if>
     <if test="param.limitdate!=null"> and CpComplaintsreport.LIMITDATE like #{param.limitdate}</if>
     <if test="param.acceptedDate!=null and param.registerdate!=null"> and CpComplaintsreport.REGISTERDATE BETWEEN #{param.acceptedDate} AND #{param.registerdate}</if>
     <if test="param.acceptedDate!=null and param.registerdate==null"> and CpComplaintsreport.REGISTERDATE BETWEEN #{param.acceptedDate} AND to_DATE('9999-12-31','yyyy-MM-dd')</if>
     <if test="param.acceptedDate==null and param.registerdate!=null"> and CpComplaintsreport.REGISTERDATE BETWEEN to_DATE('0000-01-01','yyyy-MM-dd') AND #{param.registerdate}</if>
     <if test="param.infoid!=null"> and CpComplaintsreport.ID like #{param.infoid}</if>
     <if test="param.businessType!=null"> and CpComplaintsreport.BUSINESS like #{param.businessType}</if>
     <if test="param.operator!=null"> and CpComplaintsreport.OPERATOR like #{param.operator}</if>
     <if test='param.isdelay=="1"'> and CpComplaintsreport.limitDate  &lt; (select to_date((select to_char(SYSDATE,'yyyy-mm-dd') from dual),'yyyy-mm-dd') from dual) and CpComplaintsreport.status ！='5'</if> 
     <if test='param.isdelay=="2"'> and CpComplaintsreport.limitDate  &gt; (select to_date((select to_char(SYSDATE,'yyyy-mm-dd') from dual),'yyyy-mm-dd') from dual) or CpComplaintsreport.status ='5'</if>     
   	 <if test="param.temp1!=null or param.temp2!=null or param.temp3!=null"> ORDER BY</if>
     <if test='param.temp1=="1"'> CpComplaintsreport.LIMITDATE</if>
     <if test='param.temp1=="3"'> CpComplaintsreport.registerdate</if>
     <if test='param.temp1=="2"'> (select( trunc(sysdate) - CpComplaintsreport.limitDate )from dual) </if>
     </select>
     
     <select id="adjustment" resultMap="CpComplaintsreport" parameterType="org.gecko.framework.complaint.entity.CpComplaintsreport">
         select CpComplaintsreport.* from CP_COMPLAINTSREPORT CpComplaintsreport where CpComplaintsreport.id in
		 (select CpComplaintsreport.id from (CP_COMPLAINTSREPORT CpComplaintsreport inner join CP_COMPLAINTPRODUCT CpComplaintproduct 
		 on CpComplaintsreport.Product = CpComplaintproduct.Id) 
		 inner join  cp_respondent CpRespondent on CpRespondent.Id = CpComplaintsreport.Respondent
		 where 
	 <if test='complainantname==null and batchNumber==null and product==null and approvalNumber==null'>1=2</if>
	 <if test='complainantname!=null or batchNumber!=null or product!=null or approvalNumber!=null'>CpRespondent.Respondentname like #{complainantname,jdbcType=VARCHAR}</if>
	 <if test="approvalNumber!=null"> or CpComplaintproduct.approval like #{approvalNumber,jdbcType=VARCHAR}</if>
	 <if test="batchNumber!=null"> or CpComplaintproduct.Batch like #{batchNumber,jdbcType=VARCHAR}</if>
	 <if test="product!=null"> or CpComplaintproduct.Product like #{product,jdbcType=VARCHAR}</if>
	  and CpComplaintsreport.refid is null or CpComplaintsreport.refid ='0')
	 </select>
	</mapper>
	 
	 
	 
	