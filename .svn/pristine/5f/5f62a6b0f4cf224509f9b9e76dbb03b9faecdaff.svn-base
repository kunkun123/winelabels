<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ page import="org.gecko.common.utils.GeckoProperties" %>
<%@ page import="org.gecko.framework.system.entity.Account" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>  
<html>
<head>
	<meta charset="UTF-8">
    <title>system-Account</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/static/styles/css/ace-fonts.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/font-awesome.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/bootstrap.css"/>
    <link rel="stylesheet" type="text/css" href="/static/styles/css/bootstrap-table.min.css"/>
    <link rel="stylesheet" href="/static/scripts/gecko-modules/bootstrap/bootstrap-editable.css">
    <link rel="stylesheet" type="text/css" href="/static/styles/css/ace.css"/>
   
    <link rel="stylesheet" href="/static/styles/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/static/styles/css/bootstrap-datetimepicker.min.css" />
    <link rel="stylesheet" href="/static/styles/css/jquery-ui.custom.min.css" />
	<link rel="stylesheet" href="/static/styles/css/chosen.min.css" />
	
	<!-- ace styles -->
		<link rel="stylesheet" href="/static/static/css/system/ace/ace.min.css" class="ace-main-stylesheet" id="main-ace-style" />

		<!--[if lte IE 9]>
			<link rel="stylesheet" href="assets/css/ace-part2.min.css" class="ace-main-stylesheet" />
		<![endif]-->
		<link rel="stylesheet" href="/static/static/css/system/ace/ace-skins.min.css" />
		<link rel="stylesheet" href="/static/static/css/system/ace/ace-rtl.min.css" />

		<!--[if lte IE 9]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->
	<script type="text/javascript" src="/static/scripts/gecko-modules/jquery/jquery-2.2.1.min.js"></script>
    <script src="/static/scripts/gecko-modules/bootstrap/bootstrap.min.js"></script>
    
    <script type="text/javascript" src="/static/scripts/gecko-modules/bootstrap/bootstrap-table.js"></script>
	<!-- ace scripts -->
	<script src="/static/scripts/gecko-modules/ace/ace-elements.min.js"></script>
	<script src="/static/scripts/gecko-modules/ace/ace.min.js"></script>
		<script type="text/javascript" src="/static/scripts/gecko-modules/bootstrap/bootstrap-table-zh-CN.js"></script>
	
	<script src="/static/scripts/gecko-modules/bootstrap/bootstrap-datetimepicker.js"></script>
    <script src="/static/scripts/gecko-modules/jquery/jquery.inputlimiter.min.js"></script>
   
<style>
.moreCondition{
	display:none;
}
</style>		
<title>投诉举报流程</title>
</head>
<body class="no-skin">
<!--顶部按钮-->
<div class="page-content">
<form role="form" action="/trusteeship/mgtrusteeship/delegate">
<table class="table table-hover">
 <tbody class="form-inline">  
	<tr class="table-bordered">
		<td class="col-md-4 table-bordered" style="width:50%">
			<label class="control-label bolder blue" for="form-field-1">&nbsp;&nbsp;&nbsp;&nbsp;被委托人：</label>
				<select id ="mandatary" name="mandatary">
					<option>请选择</option>
				</select>
		</td>
	</tr>
	<tr class="table-bordered">
		<td class="col-md-4 table-bordered" colspan="2">
		 	<label class="control-label bolder blue" for="form-field-1">&nbsp;&nbsp;&nbsp;&nbsp;委托说明：</label>
			<textarea type="text" id="delegateComment" name="delegateComment" class="form-control limited" style="width: 438px; height:98px"></textarea>
	    </td>    
	 </tr> 
	  <tr class="table-bordered">
	  	<td align="center">
		  	<input type="submit" class="btn btn-primary"></input>
	 	</td>
	 	
	 </tr> 

	</tbody>
	</table>
</form>
		<td  align="center">
	 	</td>
<table id="taskList"></table>
</div>
</body>
</html>
<%
    Account acct = (Account) session.getAttribute(GeckoProperties.SESSION_KEY);
    String acctId = acct.getId();
%>
<script type="text/javascript">

$(function () {
	
	//查询与本人同部门的被委托人
	 $.ajax({
             type: "GET",
             url: "/system/organization/getDeparmentAccount",
             dataType: "json",
             success: function(data){
	              $.each(data, function(i, account){
	              		//不展示本人
		              if("<%=acctId%>"!=account.id){
		             	 $("#mandatary").append("<option value='"+account.id+"'>"+account.realName+"</option>");
		              }         
	              });         
           }
    });
	
	$("#taskList").bootstrapTable({
                //toolbar: "#toolbar",
                idField: "id",
                
                //pagination: true,
                limit: 15,
                pagination: true, //是否显示分页（*）     
                //showRefresh: true,
                sidePagination: "server",
                //search: true,
                pageNumber:1,                       //初始化加载第一页，默认第一页
                pageSize: 10,                       //每页的记录行数（*）
                pageList: [10, 25, 50, 100],        //可供选择的每页的行数（*）
                url: "/trusteeship/mgtrusteeship/delegateList",
                queryParams:queryParams,
                columns: [  
                [{
                         "title": "<div style='float:left'><img src='/static/scripts/gecko-modules/img/u152.png' class='img-rounded' >委托列表</div>"
                         +"<div style='float:right'><button id='withdraw' onclick='withdrow();' class='btn btn-xs btn-primary'>撤回所有委托</button></div>",
                         "halign":"left",
                         "align":"center",
                         "colspan": 15
                }],
                
                [{
                    checkbox: true
                }, {
                    field: "id",
                    visible: false
                },{
                    field: "delegateComment",
                    title: "委托说明",
                    type: "text",
                    search: "true",
                     sortable: true,
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "delegateStatus",
                    title: "委托状态",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }, {
                    field: "consigner",
                    title: "委托人",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                },{
                    field: "mandatary",
                    title: "被委托人",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                },{
                    field: "delegateDate",
                    title: "委托时间",
                    type: "text",
                    search: "true",
                    editable: {
                        type: "text"
                    }
                }]]
            });
     	
});
	function operateFormatter(value, row, index) {
		if(row.status=="已签收"){
			 return [
			      '<button id="oleOfedit" onclick="javascript:c('+row.cpComplaintsreportId+');" type="button" class="oleOfedit btn btn-primary  btn-sm" style="margin-right:15px;">登记</button>'
			      ].join('');
		}
     
	};
	window.operateEvents = {
	    'click .oleOfedit': function (e, value, row, index) {
	    	33();
	    	//alert(111);
	    	
	    	console.log(row);
	    	//window.location.href="/workflow/startProcess?id="+row.id; 
		}
	};
	function a(taskId){
		window.open("/workflow/viewCurrentImage?taskId="+taskId);
	}
	function b(taskId){
		window.location.href = "/workflow/complaint/autio?taskId="+taskId;
	}
	function c(cpComplaintsreportId){
		window.location.href = "/complaint/cpcomplaintsreport/registerView?cpComplaintsreportId="+cpComplaintsreportId;
	}
	function queryParams(params) {
	    var param = {
	        source : $("#source").val(),
	        businessType : $("#businessType").val(),
	        startDate : $("#startDate").val()
	    }
	    return param;
	} 
	function delegate(){
	  $('#taskList').bootstrapTable('refresh');  
	}
	function getMoreQuery(){
		$("[name='moreCondition']").removeClass("moreCondition");
		$(this).hide();
	}
	function getlessQuery(){
		$("[name='moreCondition']").addClass("moreCondition");
	}
	function withdrow(){

		window.location.href = "/trusteeship/mgtrusteeship/withdrawDelegate";
	};
	
	$('textarea.limited').inputlimiter({
					limit:50,
					remText: '您还可以输入%n 字数',
					limitText: '最多允许 : %n。'
	});
</script>
